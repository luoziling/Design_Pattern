# 操作系统实战45讲

## 常见问题

- 什么是操作系统
  - 管理软硬件资源 屏蔽硬件交互复杂性 文件、进程、内存、硬件管理
- 系统调用
  - 程序运行在用户态/内核态，普通都是用户态，用户态无法进一步访问系统资源例如进程，内存，文件，硬件 都需要操作系统提供对外接口 这类接口就是系统调用
- 进程和线程的区别
  - 线程是程序执行最小单位 进程是资源分配最小单位，一个进程多个线程，例如jvm中部分是线程共享，一个Java程序可以开启多个线程，多线共享部分进程内存
- 进程状态：创建，就绪，运行，阻塞，结束
- 进程通信，管道、匿名管道（非父子进程）、消息队列、socket、信号量、共享内存
- 线程同步，锁、信号量、同步机制，countlatch异步转同步
- 进程调度 
  - FCFS 先来先服务
  - SJF 短作业优先
  - 时间片轮转，最公平、简单、使用广泛，CPU分时间片，每个进程被分配到就执行一段时间
  - 多级优先队列，多维度进程排序决定执行顺序
  - 优先队列 按照一定规则对进程排序执行
- 死锁
  - 多进程争夺有限资源，例如AB两个进程争夺CD两个资源A拿到CB拿到D同时争取对方手上的形成死锁
  - 互斥条件
    - 不可破坏，保证多进程访问正确性的基础
  - 不可剥夺
    - 申请到的资源使用完之前不可剥夺，申请多个资源发现资源被占用放弃自身资源
  - 请求和保持
    - 保留自身资源又去申请其他资源，一次申请所有资源
  - 环路等待
    - 进程申请资源路线形成死循环，通过合适的申请顺序解决这个问题
- 内存管理
  - 申请和释放内存，逻辑地址转为物理地址
- 内存划分规则
  - 块 连续大块的段，浪费内存，连续分配
  - 页 离散 比块小 页表转换逻辑到物理
  - 段 离散 比页小 每段增加额外记录的属性 通过段表进行地址转换
  - 段页，先分段再分页，两者内部都是离散
- 快表和多级页表
  - 快表解决内存与CPU速度步匹配问题，类似cache
    - 一种缓存机制缓存部分/全部快表，加快读取速度，在快表找得到直接访问对应物理内存，找不到则加载页表数据到快表
  - 多级页表解决页表存储数据过多占用空间大的问题，一部分有用的载入内存即可其余的可以持久化到磁盘，减少存储压力
- 

## 01 | 程序的运行过程：从代码到机器运行

你知道程序是如何运行的吗？

- Java程序的运行包含以下步骤
- 编写.java文件
- 前端编译器编译为.class文件
- 由JVM的类加载子系统将class文件通过类加载器载入内存成为虚拟机可直接使用的class对象 具体步骤包含以下几步
  - 加载
    - 载入内存生成class对象
  - 验证
    - 验证class文件的正确性，以及Java语法的正确性
  - 准备
    - 类变量的初始化
  - 解析
    - 动态链接，调用替换
  - 初始化
    - 类初始化静态变量+静态方法块
- **扎实的基本功就像手里的指南针，你可以一步步强大到不依赖它，但是不能没有。**

### 计算机简史

- ken thompson c语言以及unix操作系统
- 图灵机，概念上讲述计算机的运行需要存储、寻址（执行顺序）、计算
- 冯 诺伊曼 计算机体系，将计算机分为 计算器、控制器、存储器、输入、输出 五个部分

### 更形象地将 HelloWorld 程序装入原型计算机

我们可以通过 gcc -c -S HelloWorld 得到（只能得到其汇编代码，而不能得到二进制数据）。我们用 objdump -d HelloWorld 程序，得到 /lesson01/HelloWorld.dump，其中有很多库代码（只需关注 main 函数相关的代码），如下图：

![](https://static001.geekbang.org/resource/image/39/14/3991a042107b90612122b14596c65614.jpeg)



### 小结

现代电子计算机正是通过内存中的信息（指令和数据）做出相应的操作，并通过内存地址的变化，达到程序读取数据，控制程序流程（顺序、跳转对应该图灵机的读头来回移动）的功能。



