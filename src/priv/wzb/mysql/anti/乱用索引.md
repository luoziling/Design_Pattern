# 乱用索引

## 目标：优化性能

改善性能的最好技术就是在数据库中合理使用索引。索引是排好序的快速查找数据结构。

## 反模式：无规划地使用索引

错误：

- 不使用索引或索引不足
- 使用了太多的索引或者使用了一些无效索引
- 执行一些让索引无能为力的查询

索引同步会让INSERT\UPDATE\DELETE带来额外的开销

但索引会有足够多的好处抵消它的额外开销

索引不是标准，每个数据库的具体实现会有所差别，但基本的逻辑和理论是通用的。

**索引过多**

只有使用的索引才有用

1. 主键自带索引
2. 字符串列使用前缀索引以减少索引占据长度
3. 组合索引最左前缀原则

**索引也无能为力**

进行无法使用索引的查询。

1. 不满足最左前缀匹配
2. 查询使用函数
3. 使用OR类似UNION导致部分索引无法使用，组合索引类似多个单独索引的连接
4. 使用like并且将匹配符号前置

## 如何识别反模式

1. 怎么执行的更快
2. 每个字段都用了索引
3. 索引会让数据库变慢，索引不应该使用

## 合理使用

尝试，确定哪些索引是有用的

## 解决方案：MENTOR你的索引

- 测量（Measure）

  慢查询日志

- 解释（Explain）

  执行报表

- 挑选（Nominate）

- 测试（Test）

- 优化（Optimize）

- 重建（Rebuild）

  ANALIYZE TABLE or OPTIMIZE TABLE

了解你的数据，了解你的查询请求，然后MENTOR你的索引