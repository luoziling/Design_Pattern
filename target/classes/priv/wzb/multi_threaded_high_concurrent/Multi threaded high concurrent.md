# Multi threaded high concurrent

*synchronized* 锁什么？锁对象。 

可能锁对象包括： *this*， 临界资源对象，*Class* 类对象。

同步代码块的同步粒度更加细致，是商业开发中推荐的编程方式。可以定位到具体的同 

步位置，而不是简单的将方法整体实现同步逻辑。在效率上，相对更高。

## Java锁的种类

<https://www.cnblogs.com/qifengshi/p/6831055.html>

公平锁：synchronized默认就是公平锁并且无法改变

ReentrantLock可以在初始化的时候通过构造函数设定为非公平锁

非公平锁吞吐量大但是可能出现饥饿现象以及优先级反转

上面讲的独享锁/共享锁就是一种广义的说法，互斥锁/读写锁就是具体的实现。
互斥锁在Java中的具体实现就是`ReentrantLock`
读写锁在Java中的具体实现就是`ReadWriteLock`

## 偏向锁/轻量级锁/重量级锁

这三种锁是指锁的状态，并且是针对`Synchronized`。在Java 5通过引入锁升级的机制来实现高效`Synchronized`。这三种锁的状态是通过对象监视器在对象头中的字段来表明的。
偏向锁是指一段同步代码一直被一个线程所访问，那么该线程会自动获取锁。降低获取锁的代价。
轻量级锁是指当锁是偏向锁的时候，被另一个线程所访问，偏向锁就会升级为轻量级锁，其他线程会通过自旋的形式尝试获取锁，不会阻塞，提高性能。
重量级锁是指当锁为轻量级锁的时候，另一个线程虽然是自旋，但自旋不会一直持续下去，当自旋一定次数的时候，还没有获取到锁，就会进入阻塞，该锁膨胀为重量级锁。重量级锁会让其他申请的线程进入阻塞，性能降低。

## 自旋锁

在Java中，自旋锁是指尝试获取锁的线程不会立即阻塞，而是采用循环的方式去尝试获取锁，这样的好处是减少线程上下文切换的消耗，缺点是循环会消耗CPU。