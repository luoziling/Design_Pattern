# 第一章 重构，第一个案例

## 问题

- 要为程序添加新的特性，代码结构无法方便地达成目标
- 需要重构程序，让新特性添加比较容易
- 添加新特性

## 重构的步骤

- 构建测试环境
  - 测试程序的自我验证从而提高开发速度
- 将大的代码块分离，越小的代码块越容易处理和移动
  - 代码块抽取为独立的函数方法
  - 留意会被改变的参数，可将返回值给可变参数
  - 由于每次修改的幅度都很小，所以错误容易被发现，不必发话大把时间去调试
  - 重构技术就是以微小的步伐修改程序。如果你犯下错误，很容易便可发现它
  - idea的ctrl+alt+M即可抽取方法
  - 方法抽取出来后可调整变量名称
  - 写出计算机理解的代码不难，难点在于写出让人也易懂的代码
- 抽取出的方法代码移动，放到合适的位置
  - 通常清空下函数应该放在它所所属的对象内
  - 去掉参数，改变名称
  - 去掉旧函数
- 清楚不必要的变量
- 重复代码提取



## 多态取代条件逻辑

- switch语句最好不要在另一个对象的基础属性上使用

- 根据需求的变化确定方法所在的类

- 一个电影多种类型，继承抽象

  - 问题：电影可在生命周期改变自身类型，但对象不行
  - 使用状态模式 解耦
  - 抽取电影类中的价格，将其改为接口与实现类，并且引用接口，具体实现可随时转换以达到状态转换的问题
  - 根据场景可分为影片状态还是计费策略，两者分别代表策略和状态

- 具体步骤

  - Replace Type Code with State/Strategy

    类型相关行为搬到state内，抽象行为

  - Move Method具体方法实现移动

    将计费方法根据状态移动到不同的实现类内

  - Replace Condition with Polymorphism去掉switch语句

- 

## 小结

- 方法抽取
- 方法移动
- 清除不必要变量
- 重复代码提取
- switch优化，使用状态/策略模式优化原有代码，抽象共同行为
- 重构是测试+小修改的不断重复

