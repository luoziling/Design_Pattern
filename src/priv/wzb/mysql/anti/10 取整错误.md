# 10 取整错误

使用float类型作为浮点数存储

- 之前计算活动评分就用了decimal是惯性 但是为什么要用呢？
- float为什么不安全而decimal安全呢？

float IEEE754 二进制编码的实数

并不是所有十进制都可以用二进制存的$E=mc^2$

例如
$$
\frac{1}{3}+\frac{1}{3}+\frac{1}{3}=1
$$

$$
0.333+0.333+0.333=0.999
$$

可以看出是无限接近而不能相等

**浮点数，分数的基础数学特性决定了由精度带来的微小差异**

- 精度有限情况下逻辑上可以认为数字相等，不必为无限精度带来的问题烦恼？

IEEE754使用二进制表示浮点数。十进制与二进制的表示差异较大

- 十进制的无限小数在二进制中表现不同
- 十进制的有限小数在二进制中要表示为无限小数 （例如59.95）

**十进制转二进制，整数部分除以2取余，小数部分乘2取整**

代表整数可以取完，小数无限分裂



```mysql
select score * 1000000 from activity_exercise where id = 60

59950000.76293945
```



可以看到放大后的float出现格式错误

误差不大，但是对于某些运算这些误差就是不可忍

```mysql
select * from activity_exercise where score = 59.95

```

**结果为空**

只能采用近似相等

```mysql
select * from activity_exercise where abs(score-59.95) < 0.000001
```

非经确浮点数对于求和、乘积等操作带来的结果差异巨大

## 反模式

多数应用取值不会这么经确

oracle的float是精确值而binary_float是非精确



## 解决

使用numeric或者decimal

两者一样

而有些无限小数依旧无法表示，例如1/3

尽可能不要使用浮点数