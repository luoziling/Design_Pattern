# 工作流系统设计

基于activiti框架进行系统设计

## 系统开发/管理员用例图

![image-20201021153121942](D:\Learning\公司学习\activiti\工作流系统设计.assets\image-20201021153121942.png)

如上图所示，系统开发/运维/管理要设定工作流要经过如下步骤

1. 工作流的确认需要业务沟通
2. 确定工作流后绘制业务流程模型
3. 调用方法/接口部署到activiti中，activiti自带25张表存储工作流相关非业务信息



- 已经设定好的工作流一般不会产生变动，如有变动需要挂起执行中的工作流实例（工作流是一个模板，工作流实例则是具体实现，类似Java中的类与对象）
- 工作流的变更不仅涉及现有处理中工作流的挂起还要决定当前的工作流实例放弃还是快速推进到完成

## 系统普通用户用例图

![image-20201021153540180](D:\Learning\公司学习\activiti\工作流系统设计.assets\image-20201021153540180.png)

一般系统用户可以根据系统中现有的工作流创建工作流实例，业务系统与activiti通过businessKey来关联

登录用户可执行工作流创建、查看自己待处理的工作流实例、实例流程处理等操作

## 系统整体技术考虑

![image-20201022171833986](D:\Learning\公司学习\activiti\工作流系统设计.assets\image-20201022171833986.png)

项目构建产生问题：

- Activiti自带与security整合，不知道能否与shiro匹配
- 使用ORM框架可能导致与activiti自带的jdbc原生访问冲突
- 登录验证可以考虑抽取登录为一项验证服务？

剔除spring security 及其产生的问题

https://blog.csdn.net/weixin_38061191/article/details/105135136

新的API中强依赖security 剔除后新API调用产生bug

继续调用老的API没问题

第二种解决方案，指挥平台使用shiro，工作流模块使用spring security

需要学习spring security

先尝试剔除用shiro替代

不行再说



shiro中的角色与授权控制

在realm中完成登录者的角色赋予及授权



## 指挥平台重构

![image-20201022171847419](D:\Learning\公司学习\activiti\工作流系统设计.assets\image-20201022171847419.png)

接入spring cloud （阿里的那一套

考虑抽离出验证中心（网关



## 功能考虑

![image-20201022173943506](D:\Learning\公司学习\activiti\工作流系统设计.assets\image-20201022173943506.png)

项目功能产生问题：

- 用户端与后台都要开发UI么

  后台找到BPMN UI如果实现优先可考虑先不做，只根据需求自己绘制

- 用户端可考虑使用表单+按钮展示（后期可考虑加入流程执行过程图

- 后台的BPMN绘制页面去参考官方example了解解决方案

- 用户端与后台可集成到一起，用权限控制分开显示